<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tạo Cấu Hình Chặn Thu Hồi - AdGuard DNS</title>
<style>
  /* Tổng thể */
  :root{
    --accent:#b94fe3;
    --accent-2:#ff88d4;
    --card-bg: rgba(255,255,255,0.85);
    --muted:#8a6f9f;
    --radius:18px;
  }
  html,body{
    height:100%;
    margin:0;
    font-family: "Helvetica Neue", Arial, sans-serif;
    background:
      radial-gradient(circle at 10% 10%, rgba(255,200,240,0.12), transparent 8%),
      radial-gradient(circle at 90% 90%, rgba(200,230,255,0.08), transparent 10%),
      linear-gradient(180deg,#fffafc 0%, #fff 60%);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
    -webkit-text-size-adjust:none;
  }

  /* Khung chính */
  .container{
    width:100%;
    max-width:420px;
    border-radius:22px;
    box-shadow: 0 8px 30px rgba(140,90,160,0.12);
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
    padding:18px;
    box-sizing:border-box;
    position:relative;
    overflow:hidden;
    border:1px solid rgba(200,150,210,0.15);
  }

  /* hoa/ảnh mờ nền (giống style ảnh) */
  .bg-flowers{
    position:absolute;
    inset:0;
    background-image: radial-gradient(circle at 70% 10%, rgba(255,210,230,0.35), transparent 10%);
    pointer-events:none;
    mix-blend-mode: soft-light;
  }

  h1.title{
    font-size:20px;
    text-align:center;
    margin:4px 0 8px 0;
    color:var(--accent);
    text-shadow:0 1px 0 white;
  }

  .tabs{
    display:flex;
    gap:8px;
    justify-content:center;
    margin-bottom:12px;
  }
  .tab{
    background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(245,235,250,0.9));
    border-radius:12px;
    padding:8px 14px;
    font-weight:600;
    color:#7b3f9a;
    box-shadow: 0 2px 6px rgba(150,90,170,0.06);
    font-size:14px;
  }

  .card{
    background:var(--card-bg);
    border-radius:14px;
    padding:12px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
    margin-bottom:12px;
    border:1px solid rgba(200,150,210,0.06);
  }

  label{ display:block; font-weight:700; color:var(--accent); margin-bottom:6px; font-size:14px;}
  .hint{ color:var(--muted); font-weight:600; padding:6px 12px; border-radius:12px; background:rgba(255,255,255,0.6); margin-bottom:8px; }

  input[type="text"], textarea{
    width:100%;
    box-sizing:border-box;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid rgba(150,110,160,0.12);
    background:rgba(255,255,255,0.7);
    outline:none;
    font-size:15px;
    color:#333;
  }
  textarea{ min-height:70px; resize:vertical; }

  .small-note{
    font-size:13px;
    color:#6b4b7a;
    margin-top:8px;
  }

  .btn-row{ display:flex; gap:10px; margin-top:12px; justify-content:center; align-items:center; }
  .btn{
    padding:12px 18px;
    border-radius:14px;
    border:0;
    cursor:pointer;
    font-weight:800;
    font-size:15px;
    box-shadow: 0 6px 18px rgba(180,100,200,0.12);
  }
  .btn-primary{
    background: linear-gradient(180deg, var(--accent-2), var(--accent));
    color:white;
  }
  .btn-ghost{
    background:transparent;
    border:1px solid rgba(160,120,190,0.12);
    color:var(--accent);
  }

  .notice{
    background:linear-gradient(180deg, rgba(255,250,240,0.8), rgba(255,255,255,0.6));
    padding:10px;
    border-radius:12px;
    color:#7b3f9a;
    font-size:13px;
    margin-top:10px;
  }

  footer.smallfoot{
    margin-top:12px;
    text-align:center;
    color:#8a6f9f;
    font-size:12px;
  }

  /* responsive */
  @media (max-width:420px){
    .container{ padding:14px; border-radius:16px; }
  }
</style>
</head>
<body>
  <div class="container" role="main">
    <div class="bg-flowers" aria-hidden="true"></div>

    <h1 class="title">✨ Tạo Cấu Hình Chặn Thu Hồi ✨<br><small style="font-weight:600;color:#7b3f9a">Sử Dụng DNS Cá Nhân Adguard</small></h1>

    <div class="tabs" aria-hidden="true">
      <div class="tab">Thông Tin</div>
      <div class="tab">Videooo</div>
      <div class="tab">Tạo Cấu Hình</div>
    </div>

    <div class="card">
      <div style="font-weight:800;color:#7b3f9a;margin-bottom:8px">⭐ File Chặn Thu Hồi</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <button class="btn btn-ghost" onclick="fillSample()">⭐ File Chặn Thu Hồi - Cập Nhật IOS ⭐</button>
        <button class="btn btn-ghost" onclick="openAdguard()">⭐ Web Adguard DNS ⭐</button>
      </div>
    </div>

    <div class="card">
      <label for="dnsName">Tên DNS:</label>
      <input id="dnsName" type="text" placeholder="VD: Cấu Hình Chặn Thu Hồi" value="Cấu Hình Chặn Thu Hồi">

      <label for="info" style="margin-top:10px">Thông Tin Cấu Hình:</label>
      <input id="info" type="text" placeholder="VD: Tạo Bởi Tìm Cook" value="Tạo Bởi Tìm Cook">

      <label for="doh" style="margin-top:10px">DNS - OVER - HTTPS (VD: https://d.adguard-dns.com/..):</label>
      <input id="doh" type="text" placeholder="VD: https://d.adguard-dns.com/dns-query" value="https://d.adguard-dns.com/dns-query">

      <div class="small-note">⭐ Nhấn "Tạo Cấu Hình" sẽ hiện nút "Tải file cấu hình", nhấp để tải và cài đặt. Nhấn giữ để chọn "Tải về tệp được liên kết" nếu cần.</div>
      <div class="btn-row">
        <button class="btn btn-primary" id="buildBtn">Tạo Cấu Hình</button>
        <button class="btn btn-ghost" id="previewBtn">Xem trước</button>
      </div>

      <div id="preview" style="display:none;margin-top:10px">
        <textarea id="previewText" readonly></textarea>
      </div>

      <div id="downloadArea" style="margin-top:10px; display:none;">
        <a id="downloadLink" class="btn btn-primary" download="adguard-profile.mobileconfig">Tải file cấu hình (.mobileconfig)</a>
        <button class="btn btn-ghost" onclick="copyToClipboard()">Sao chép nội dung</button>
      </div>

      <div class="notice" style="margin-top:12px">
        <strong>Lưu ý:</strong><br>
        - Không dùng DNS/VPN khác song song khi chưa biết có chặn thu hồi hay không.<br>
        - Trước khi khởi động lại máy: tắt mạng, bật chế độ máy bay để tránh rò rỉ; nếu không cấu hình có thể chưa kịp hoạt động dẫn đến rò rỉ và chứng chỉ bị thu hồi.
      </div>
    </div>

    <footer class="smallfoot">Không bảo mật — chỉ mô phỏng giao diện. Tải file về kiểm tra/tuỳ chỉnh trước khi cài.</footer>
  </div>

<script>
  // helper unique id
  function uuidv4(){
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){
      var r = Math.random()*16|0, v = c=='x'? r : (r&0x3|0x8);
      return v.toString(16);
    });
  }

  function openAdguard(){
    window.open('https://adguard-dns.io', '_blank');
  }

  function fillSample(){
    document.getElementById('dnsName').value = 'Cấu Hình Chặn Thu Hồi';
    document.getElementById('info').value = 'Tạo Bởi Tìm Cook';
    document.getElementById('doh').value = 'https://d.adguard-dns.com/dns-query';
  }

  function buildProfile(){
    const name = document.getElementById('dnsName').value.trim() || 'Cấu Hình Chặn Thu Hồi';
    const info = document.getElementById('info').value.trim() || '';
    const doh = document.getElementById('doh').value.trim() || '';

    const id = uuidv4();
    const payloadUUID = uuidv4();

    // A simple unsigned mobileconfig template.
    // NOTE: This is a generic template that stores entered info. Some iOS DNS features require signed profile or special payload types.
    const mobileconfig = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>PayloadContent</key>
  <array>
    <dict>
      <key>PayloadType</key>
      <string>com.apple.profile.managed</string>
      <key>PayloadVersion</key>
      <integer>1</integer>
      <key>PayloadIdentifier</key>
      <string>com.custom.adguard.dns.${id}</string>
      <key>PayloadUUID</key>
      <string>${payloadUUID}</string>
      <key>PayloadDisplayName</key>
      <string>${escapeXml(name)}</string>

      <key>PayloadDescription</key>
      <string>${escapeXml(info || 'Cấu hình DNS do người dùng tạo')}</string>

      <!-- Thông tin DNS: (LƯU Ý: payload dưới đây chỉ lưu thông tin DOH làm tham chiếu; để iOS thực sự sử dụng DOH có thể cần payload đặc thù hoặc app hỗ trợ) -->
      <key>DNS_SETTINGS</key>
      <dict>
        <key>DOH_URL</key>
        <string>${escapeXml(doh)}</string>
        <key>NOTE</key>
        <string>Profile này chứa URL DNS-over-HTTPS do người dùng cung cấp. iOS có thể cần profile có payload type chính xác hoặc chứng chỉ để kích hoạt một số tính năng.</string>
      </dict>

    </dict>
  </array>

  <key>PayloadType</key>
  <string>Configuration</string>
  <key>PayloadVersion</key>
  <integer>1</integer>
  <key>PayloadIdentifier</key>
  <string>com.custom.adguard.bundle.${id}</string>
  <key>PayloadUUID</key>
  <string>${uuidv4()}</string>
  <key>PayloadDisplayName</key>
  <string>${escapeXml(name)}</string>
  <key>PayloadDescription</key>
  <string>${escapeXml(info)}</string>
</dict>
</plist>`;

    return mobileconfig;
  }

  function escapeXml(unsafe){
    return unsafe.replace(/[&<>'"]/g, function (c) {
      switch (c) {
        case '&': return '&amp;';
        case '<': return '&lt;';
        case '>': return '&gt;';
        case "'": return '&apos;';
        case '"': return '&quot;';
      }
    });
  }

  document.getElementById('buildBtn').addEventListener('click', ()=>{
    const txt = buildProfile();
    const blob = new Blob([txt], {type: 'application/x-apple-aspen-config'}); // mobileconfig mime
    const url = URL.createObjectURL(blob);

    const dl = document.getElementById('downloadLink');
    dl.href = url;
    dl.style.display = 'inline-block';
    document.getElementById('downloadArea').style.display = 'flex';
    document.getElementById('previewText').value = txt;
    document.getElementById('preview').style.display = 'block';

    // announce to user
    alert('Đã tạo file cấu hình. Nhấn "Tải file cấu hình (.mobileconfig)" để tải xuống và cài đặt trên iPhone/iPad. Xin đọc phần Lưu ý trên trang.');
  });

  document.getElementById('previewBtn').addEventListener('click', ()=>{
    const txt = buildProfile();
    document.getElementById('previewText').value = txt;
    document.getElementById('preview').style.display = 'block';
    document.getElementById('downloadArea').style.display = 'flex';
  });

  function copyToClipboard(){
    const txt = document.getElementById('previewText').value;
    if(!txt) return alert('Không có nội dung để sao chép. Hãy bấm "Tạo Cấu Hình" trước.');
    navigator.clipboard?.writeText(txt).then(()=> alert('Đã sao chép nội dung profile vào clipboard.'));
  }

  // For better mobile UX: when clicking download link on iPhone safari, it will open the profile for install.
  // No extra code needed.
</script>
</body>
</html>